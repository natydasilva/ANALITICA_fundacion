---
title: " shiny II"
author: "Natalia da Silva, @STAT_NT <br /> <br /> <br /> Instituto de Estadística-UDELAR"
output:
  xaringan::moon_reader:
    css: ["default-fonts", "default"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
    class: middle  
---

 <style>
 .title-slide {
     background-image: url(logoclass.png);
     background-repeat: no-repeat;
     padding:40px;
     background-position: 90% 80%;
     background-size: 100px 100px;
   }
   </style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.pos = 'hbpt', out.extra = '', message = FALSE, warning = FALSE)
```


## <span style="color:#88398A"> Anuncios </span>

Quedan 4 semanas de clase contando esta (fin 3/7).

Presentación de trabajos, 4 y 6 de Julio.

Entrega de trabajo Viernes 29 de Junio

Sorteo de presentaciones y comentaristas para cada grupo

---

## <span style="color:#88398A"> Grupos </span>
- G1: Victoria Fernandez, Angel Nuñez e Ignacio Marrero

- G2: Cecilia Martino, Enrrique Sierra, Micaela Butin

- G3: Fiorella Lúngaro, Patricia Martell y Ana Vignolo

- G4: Matias Bajac, Wilson Rivas y Germán Miranda

- G5: Joaquin Scaletti, Hebenor Bermudez y Gabriela González

- G6: Jimena Padín y Gabriel Verdún

 Germán Mayo?
---

## <span style="color:#88398A"> Calendadrio proyecto </span>
- Hoy definir los datos

- Miércoles 15/6 introducción, descripción de los datos, preguntas de interés
y exploración inicial

- Miércoles 22/6, diseño y desarrollo de la shiny

- Viernes 29 entrega del proyecto
---


## <span style="color:#88398A"> `shiny` </span>

- Repaso componentes de una shiny

- Solución Actividad 11

- Estructura shiny
---


## <span style="color:#88398A">Componentes de una shiny</span>

- `ui`: "user interface" (interface de usuario), documento web en html. Se define la estructura de la aplicación 

- `server`: Conjunto de instrucciones seguidas por el servidor cuando cambia el `input`

 Siempre debemos pensar en `inputs` y `outputs` cuando construyo una `shiny`. 
 
`shiny` es construída en base al concepto de   **programación reactiva**: la idea de que un `output` debería ser automáticamente actualizado cuando modifico un `input`
---

## <span style="color:#88398A">Recapitulando otra vez!</span>
La más chiquitita!
```{r,echo=TRUE, eval=FALSE}
library(shiny)
ui <- fluidPage() #diseño de la web

server <- function(input, output){} # el código de R

shinyApp(ui = ui, server = server) # corre la aplicación


```
tu shiny debe guardarse como `app.R`
---

## <span style="color:#88398A">Solución Actividad 11 </span>

1) Modificá la shiny para que el histograma sea un ggplot2

2)  Agregá un input para cambiar la media y el desvío standard

3)  Agregá  un input para simular de una distribución gamma `rgamma` y una normal.

---


## <span style="color:#88398A">Solución 1) </span>

```{r,eval=FALSE, echo=TRUE}
library(tidyverse)
library(shiny)
ui <- fluidPage(
sliderInput(inputId = "cant",
                     label = "tamaño muestral:",
                     min = 1,
                     max = 500,
                     value = 30),
plotOutput("hist")

)
server <- function(input, output){
  output$hist <- renderPlot({

   gg <- data.frame(x = rnorm(input$cant)) %>% 
      ggplot(aes(x )) + geom_histogram(binwidth = 0.25)

   print(gg)


    })
}
shinyApp(ui, server)



``` 
---
## <span style="color:#88398A">Solución 2)</span>
```{r, echo=TRUE, eval=FALSE}

ui <- fluidPage(
sliderInput(inputId = "cant",
                     label = "tamaño muestral:", min = 1, max = 500, 
            value = 30),
numericInput(inputId = 'media', label="Media", value = 0),
numericInput(inputId = 'desvio', label = "SD", value = 1),
plotOutput("hist")
)
server <- function(input, output){
  output$hist <- renderPlot({
dist <- data.frame(x = rnorm(input$cant,
                                        mean = input$media, sd =
                                          input$desvio))
   gg <- dist %>%
      ggplot(aes(x)) + geom_histogram(binwidth = 0.25)
   print(gg)
    })
}
shinyApp(ui, server)
```
---


## <span style="color:#88398A">Solución 3) ui</span>
```{r, echo=TRUE, eval=FALSE}

ui <- fluidPage(
  sliderInput(inputId = "cant",
              label = "tamaño muestral:",
              min = 1, max = 500, value = 30),
  selectInput('distri', 'Distribución', c("Gamma", "Normal")),
  plotOutput("hist")
)
```

---

## <span style="color:#88398A">Solución 3) `server`</span>
```{r, eval=FALSE,echo=TRUE}
server <- function(input, output){
  output$hist <- renderPlot({
  if (input$distri == "Normal") {
  dist <- data.frame(x = rnorm(input$cant))
  gg <- dist %>%
  ggplot(aes(x)) + geom_histogram(binwidth = 0.25)
  print(gg)
  }else{
  dist <- data.frame(x = rgamma(
  n = input$cant, shape = 1  ))
  gg <- dist %>%
  ggplot(aes(x) ) + geom_histogram(binwidth = 0.25)
  print(gg) 
  }
  })
}
shinyApp(ui, server)
```
---


## <span style="color:#88398A">Veremos</span>

-  `shiny` te hace trabajar en códigos separados una parte para la interfaz de usuario (the front end) y otra con el código que controla el comportamiento de la aplicación (the back end).

- Nos enfocaremos en `the front end` viendo algunos de los inputs y outputs de HTML que shiny permite incluir.

- Veremos como se pueden con ellos capturar distintas estructuras de datos y mostrar distintos tipos de resultados

---

## <span style="color:#88398A"> UI básico</span>

- Vimos que hay distintas funciones para incluir `inputs` de control en shiny UI como: `selectInput()`, `sliderInput()`, `textInput()`y `numericInput()`.

- Definiriemos la estructura común de los controles y veremo algunas de ellas
---


## <span style="color:#88398A"> UI Básico</span>

- `ui` Dentro de `fluidPage` se pueden definir otros elementos como `titlePanel`, `sidebarLayout` entre otros.

- `sidebarLayout` tiene como argumentos principales `sidebarPanel` y ` mainPanel`

Veremos al final como usar esto para estructurar la shiny


---

## <span style="color:#88398A">Estructura común input</span>

- Todas las funciones `input` tiene el mismo primer argumento:  `inputId` que es el identificador que utilizaremos para conectar el **front end** con el **back end** 

- Si tu UI tiene un `input` con ID "pancho"  la función `server` accederá a ese valor mediante `input$pancho`.

Hay dos restricciones para `inputId`:

- Debe ser una cadena de caracteres (letras, números y _) pero no incluir espacios, comas o otros caracteres especiales.

- Debe ser único ya que debe ser usado como identificar de control en el server

La mayoría de los `inputs` tienen un segundo argumento `label` que genera una etiqueta legible en la app.

El tercer parámetro es `value` que se puede definir el defecto y el resto de los parámetros son particulares de cada control
---


## <span style="color:#88398A"> Texto libre</span>
```{r, eval=FALSE}
ui <- fluidPage(
  textInput(inputId = "nombre", label = "Cuál es tu nombre?"),
  passwordInput(inputId = "clave", label = "Cuál es tu clave?"),
  textAreaInput(inputId ="cuento", label = "Contame algo sobre ti",
                rows = 3)
)

server<- function(input, output){}
shinyApp(ui,server)
```
---

## <span style="color:#88398A">Inputs numéricos</span>


```{r, eval=FALSE}
ui <- fluidPage(
  numericInput(inputId = "N1", label = "Número 1", value = 0, 
               min = 0, max = 100),
  sliderInput(inputId = "N2", label = "Número 2", value = 50,
              min = 0, max = 100),
  sliderInput(inputId = "N3", label = "Rango", value = c(10, 20), 
              min = 0, max = 100)
)

server<- function(input, output){}
shinyApp(ui,server)
```

Si no es muy importante que el valor sea preciso se puede usar `sliderInput` y hay formas de personalizar como luce https://shiny.rstudio.com/articles/sliders.html
---

## <span style="color:#88398A">Fechas</span>
Para un sólo día `dateInput()` o un rango entre fechas `dateRangeInput()`. 

```{r, eval=FALSE}
ui <- fluidPage(
  dateInput("nac", "Fecha de nacimiento"),
  dateRangeInput("ingreso", "Ingreso a facultad y egreso esperado")
)
server<- function(input, output){}
shinyApp(ui,server)
```

Da un calendario para la selección y argumentos adicionales para deshabilidar algún día o días de la semana  `datesdisabled` y `daysofweekdisabled`
---

## <span style="color:#88398A">Conjunto de opciones</span>

```{r, eval=FALSE}
cuadros <- c("nacional", "peñarol", "defensor", 
             "liverpool", 'danubio', "cerro", 
             "torque","otro")

ui <- fluidPage(
  selectInput("color","Color favorito",colors()
              [c(1,8,18,26,32,57,151,254,260,498,536,547,554,
                 640,652)], multiple=TRUE),
  radioButtons("cuadro", "De que cuadro sos?", cuadros)
)
server<- function(input, output){}
shinyApp(ui,server)
```
  `radioButtons` muestran todas las opciones, se usan para listas cortas con `choiceNames` puedo agregar lo que se ve en la app y `choiceValues`  determina los valores que se retornan en la función server 
  
`selectInput` no muestra todas las opciones, para listas más largas y permite multiples selecciones con `multiple = TRUE`

No se pueden hacer selecciones multiples con `radioButtons` para eso usar `checkboxGroupInput()`

`checkboxInput()` para preguntas dicotómicas
---

## <span style="color:#88398A">Subir archivos y botones de acción</span>

```{r, eval=FALSE}
ui <- fluidPage(
  fileInput("sube", NULL)
)
server<- function(input, output){}
shinyApp(ui,server)
```

```{r,eval=FALSE}
ui <- fluidPage(
  actionButton("click", "Seleccioná aquí")
)
server<- function(input, output){}
shinyApp(ui,server)
```
---

## <span style="color:#88398A">Outputs</span>
- Los outputs definidos en UI crea un espacio que se rellena posteriormente en la función server .
- Como los inputs, tienen un identificador único (outputId)
- Si tu outputId es 'hola' se accede a este en la función server con output$hola

- Cada función en el **front end** (UI) es pareada con una de tipo render en el **back end** (server) 

- Hay tres tipos principales de output, texto, tablas y  gráficos. 

---


## <span style="color:#88398A">Texto</span>
Texto plano se incluye con `textOutput()` y código fijo y salidas `verbatimTextOutput()`.
```{r, eval=FALSE}
ui <- fluidPage(
  textOutput("texto"),
  verbatimTextOutput("codigo")
)
server <- function(input, output) {
  output$texto <- renderText({ 
    "Jugate estos al 5 de oro!" 
  })
  output$codigo <- renderPrint({ 
   sample(1:48,5)
  })
}

shinyApp(ui,server)
```
Las funciones render requieren {} si se quieren correr muchas lineas de código
---
## <span style="color:#88398A">Tablas</span>
Hay dos opciones para mostrar data.frames en tablas:
- `tableOutput()` y `renderTable()` muestra una tabla estática completa.

- `dataTableOutput()` y `renderDataTable()`  para tablas dinámicas, presenta número fijo de filas pero permite seleccionar cuales mostrar mediante controles.

---

## <span style="color:#88398A">Tablas</span>

```{r,eval=FALSE}
ui <- fluidPage(
  tableOutput("estatico"),
  dataTableOutput("dinamico")
)
server <- function(input, output) {
  output$estatico <- renderTable(head(mtcars))
  output$dinamico <- renderDataTable(mtcars, 
                                     options = list(pageLength = 5))
}
shinyApp(ui,server)
```
---

## <span style="color:#88398A">Gráficos</span>

Se pueden hacer gráficos con `plotOutput()` y `renderPlot()`
```{r,eval=FALSE}
ui <- fluidPage(
  plotOutput("fig", width = "400px")
)
server <- function(input, output, session) {
  output$fig <- renderPlot({
    ggplot(mtcars) + geom_point(aes(disp,mpg), res = 96)
                                   })
}

shinyApp(ui,server)
```
`res=96` para que luzca como se ve en RStudio.

---


## <span style="color:#88398A">Estructura UI</span>
Veremos como estructurar la app para organizar los resultados.

```{r, eval=FALSE}
ui <- fluidPage(
  titlePanel("Mi pequeña app"),

  sidebarLayout(
    sidebarPanel("Panel izquierdo"),
    mainPanel("Panel principal")
  )
)
server <- function(input, output){} 
shinyApp(ui = ui, server = server)
```
---

## <span style="color:#88398A">Estructura, ui</span>

```{r, eval=FALSE}
ui <- fluidPage(
  titlePanel("Mi pequeña app"),

  sidebarLayout(position = "right",
    sidebarPanel("Panel izquierdo"),
    mainPanel("Panel principal")
  )
)
server <- function(input, output){} 
shinyApp(ui = ui, server = server)
```
---

## <span style="color:#88398A">Diseño</span>

- `shiny` permite diseñar distintos componentes de la app

- El diseño más sencillo es el que vimos con `sidebar` que contiene los `imputs` y el área principal para los `outputs`

- Se pueden definir filas y columnas `fluidRow()` con distintas columnas

- Segmentar el diseño con `tabsetPanel()` o `navlistPanel()`


---

## <span style="color:#88398A">Diseño</span>
```{r, eval=FALSE}
ui <- fluidPage(
  titlePanel("Mi pequeña app"),

  fluidRow(
    column(3,
      sliderInput('nsize', 'Muestra', 
                  min = 1, max = 100, value = 50, 
                  )
      ),
    column(3, offset = 1,
      selectInput('y', 'Clase', c("A","B"))
      ),
    column(3, offset = 1,
      selectInput('color', 'Color', c('Blanco', "Negro"))
    )
  ))
server <- function(input, output){} 
shinyApp(ui = ui, server = server)
```

---


## <span style="color:#88398A">Estructura, pestañas</span>

```{r, eval=FALSE}
ui <- fluidPage(

  titlePanel("Tabsets"),

  sidebarLayout(
    
    sidebarPanel(
    ),
  
    mainPanel(
      tabsetPanel(
        tabPanel("Exploración", plotOutput("plot")), 
        tabPanel("Modelos", verbatimTextOutput("summary")), 
        tabPanel("Resumen", tableOutput("table"))
      )
    )
  )
)
server <- function(input, output){} 
shinyApp(ui = ui, server = server)
```
---


## <span style="color:#88398A">Navlists and navbars</span>
- Las pestañas se muestran horizontales tienen la limitante de espacio si tiene títulos largos.

- `navbarPage()` y `navbarMenu()` dan dos alternativas que permiten más pestañas that cpn nombre largos

- `navlistPanel()` similar a `tabsetPanel()` pero poniendo vertical lo que antes estaba horizontal 
---

## <span style="color:#88398A">Navlists and navbars</span>

```{r,eval=FALSE}
ui <- fluidPage(
  navlistPanel(
    id = "tabset",
    "Tema 1",
    tabPanel("panel 1", "Muestra el Panel 1"),
    "Tema 2",
    tabPanel("panel 2", "Muestra el Panel 2"),
    tabPanel("panel 3", "Muestra Panel 3")
  )
)
server <- function(input, output){} 
shinyApp(ui = ui, server = server)
```
---

## <span style="color:#88398A">Navlists and navbars</span>
`navbarPage()` pone las pestañas horizontales pero con `navbarMenu()` puedo poner un menú de opciones 

```{r, eval=FALSE}
ui <- navbarPage(
  "Título ",   
  tabPanel("panel 1", "Muestra el panel 1"),
  tabPanel("panel 2", "Muestra el panel 2"),
  tabPanel("panel 3", "Muestra el panel 3"),
  navbarMenu("subpaneles", 
    tabPanel("panel 4a", "cuatro-a"),
    tabPanel("panel 4b", "cuatro-b"),
    tabPanel("panel 4c", "cuatro-c")
  )
)
server <- function(input, output){} 
shinyApp(ui = ui, server = server)
```
---


## <span style="color:#88398A">Contenido HTML</span>
- Personalizá tu `shiny` `ui` con HTML.
- Dentro de las funciones `*Panel` se puede incluir funciones etiquetadas para que sean iguales a  HTML5 (HTML tags).Más tags se encuentran en  [tags HTML](http://shiny.rstudio.com/articles/tag-glossary.html)

<img src="html5.png" height="400px" width="600px"/>


---
## <span style="color:#88398A">Contenido HTML</span>
```{r, eval=FALSE}
ui <- fluidPage(
  titlePanel(
    h1("Mi pequeña app")
    ),

  sidebarLayout(
    sidebarPanel(
      h2("Panel izquierdo")
      ),
    mainPanel(
      h1("Panel principal", align = "center")
      )
  )
)
server <- function(input, output){}
shinyApp(ui = ui, server = server)
```
---



## <span style="color:#88398A">Imágenes</span>

- Se pueden incluir imágenes externas.

- `shiny` busca la función `img` para poner las imágenes en tu app

- `img(src = "tu_imagen.png", height = 30, width = 30)`

- La función `img` busca el archivo de la imagen en un lugar específico, tiene que estar en una carpeta llamada www en el mismo directorio donde está  tu app.r



---
## <span style="color:#88398A">Imágenes</span>

```{r, eval=FALSE}
ui <- fluidPage(
  titlePanel("Mi pequeña app"),

  sidebarLayout(position = "right",
    sidebarPanel("Panel izquierdo"),
    mainPanel(
      img(src = "logoclass.png", height = 140, width = 400)
      )
  )
)
server <- function(input, output){}
shinyApp(ui = ui, server = server)
```
Armá una carpeta `app1` que contenga el archivo `app.R` con el código y una carpeta `www` con `logoclass.png` u otra imagen que selecciones.

